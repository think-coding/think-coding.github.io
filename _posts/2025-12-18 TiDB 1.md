# TiDB 面试高频易错点清单（避坑指南）
## 一、基础概念类易错点
1.  **混淆 TiDB 架构层级**
    - 错误表述：`TiKV 是 SQL 层，负责解析 SQL`
    - 正确认知：TiDB Server 是 SQL 层，TiKV 是存储层；PD 是集群管理大脑，**不是**存储组件。
    - 避坑提示：记住「**TiDB 算，TiKV 存，PD 管**」的口诀。

2.  **误解 Region 与分片键的关系**
    - 错误表述：`给 user_id 加索引就能让数据按 user_id 分片`
    - 正确认知：TiDB 仅按**主键（分片键）**拆分 Region，普通索引不影响分片规则；要按 user_id 分片，必须将其设为主键前缀。
    - 避坑提示：分片键 = 主键，普通索引只加速查询，不决定数据分布。

3.  **Raft 协议应用范围混淆**
    - 错误表述：`TiDB Server 之间用 Raft 协议选主`
    - 正确认知：TiDB Server 是无状态的，无需选主；Raft 仅用于 **PD 集群选主** 和 **TiKV Region 副本同步**。
    - 避坑提示：Raft 只作用于有状态组件（PD/TiKV）。

4.  **TiFlash 功能误解**
    - 错误表述：`TiFlash 是独立的数据库，需要手动同步数据`
    - 正确认知：TiFlash 是 TiDB 的列存引擎，作为 TiKV 的 **Raft Learner** 实时同步数据，无需手动 ETL；查询时由 TiDB 优化器自动路由。
    - 避坑提示：TiFlash 是 TiDB 生态组件，不是独立数据库。

## 二、架构原理类易错点
1.  **分布式事务实现混淆**
    - 错误表述：`TiDB 分布式事务基于单纯的 2PC 协议`
    - 正确认知：TiDB 基于 **Percolator 模型 + 2PC**，核心是 Primary/Secondary 锁机制，PD 提供 TSO 保证全局事务顺序，不是单纯的 2PC。
    - 避坑提示：Percolator 是 TiDB 事务的核心，2PC 是其中的执行阶段。

2.  **Leader 角色混淆**
    - 错误表述：`TiKV 集群只有一个 Leader 节点`
    - 正确认知：TiKV 的 Leader 是**按 Region 划分**的，每个 Region 有独立 Leader，不同 Region 的 Leader 分布在不同 TiKV 节点，实现负载均衡。
    - 避坑提示：PD Leader 是集群唯一的，TiKV Leader 是 Region 级别的。

3.  **MVCC 实现误解**
    - 错误表述：`TiDB 的 MVCC 基于事务 ID 实现`
    - 正确认知：TiDB 的 MVCC 基于 **PD 下发的 TSO 时间戳**，每行数据的不同版本关联不同时间戳，读取时选择小于当前事务 TSO 的最新版本。
    - 避坑提示：TSO 是 TiDB 分布式一致性的核心，贯穿事务和 MVCC。

4.  **悲观锁/乐观锁默认值混淆**
    - 错误表述：`TiDB 默认使用乐观锁，和 MySQL 不一样`
    - 正确认知：TiDB **默认使用悲观锁**，与 MySQL 行为一致；乐观锁需手动通过 `SET tidb_txn_mode = 'optimistic'` 开启。
    - 避坑提示：悲观锁适合高冲突场景（如秒杀），乐观锁适合低冲突场景。

## 三、运维调优类易错点
1.  **集群最小部署误解**
    - 错误表述：`生产环境可以部署 2 个 PD 节点`
    - 正确认知：PD 集群必须部署**奇数个节点**（3/5），因为 Raft 协议需要超过半数节点存活才能选举 Leader；2 个 PD 节点时，1 个故障就无法选主，集群不可用。
    - 避坑提示：PD 节点数必须是奇数，生产最小 3 节点。

2.  **自增主键的使用误区**
    - 错误表述：`TiDB 自增主键和 MySQL 一样，适合做分片键`
    - 正确认知：TiDB 自增主键是**全局唯一**的，但单调递增会导致写入集中在最后一个 Region，形成热点；仅适合以主键为核心查询的场景，否则建议用复合分片键（如 user_id + id）。
    - 避坑提示：自增主键 = 写入热点，非主键查询场景慎用。

3.  **大事务处理误区**
    - 错误表述：`调大 tidb_txn_total_size_limit 参数就能解决大事务问题`
    - 正确认知：调大参数只是临时方案，大事务的核心问题是**锁持有久、Raft 同步开销大**；最优解是拆分大事务为多个小事务，批量操作加 LIMIT 限制单次处理数据量。
    - 避坑提示：大事务是 TiDB 性能杀手，优先拆分，而非调参。

4.  **热点问题解决误区**
    - 错误表述：`热点问题只能通过扩容解决`
    - 正确认知：扩容是兜底方案，热点问题的核心解决思路是**打散数据分布**：优化分片键（复合键/哈希键）、限制单请求 QPS、读写分离（读路由到 Follower）。
    - 避坑提示：先优化数据分布，再考虑扩容。

## 四、综合对比类易错点
1.  **TiDB 与 MySQL 分库分表对比误区**
    - 错误表述：`TiDB 和 Sharding-JDBC 一样，都是中间件`
    - 正确认知：TiDB 是**原生分布式数据库**，自动分片、原生支持分布式事务；Sharding-JDBC 是分库分表中间件，需手动维护物理分表，跨分片事务需额外处理。
    - 避坑提示：TiDB 是数据库，Sharding-JDBC 是中间件，架构层级不同。

2.  **社区版与企业版功能混淆**
    - 错误表述：`TiDB 企业版比社区版多分布式事务功能`
    - 正确认知：分布式事务、水平扩展等核心功能社区版和企业版完全一致；企业版的优势是 **信创合规、图形化运维、官方技术支持**，而非核心功能增强。
    - 避坑提示：核心功能无差异，企业版卖的是服务和合规。

3.  **TiDB 适用场景误解**
    - 错误表述：`TiDB 适合所有数据库场景，能替代 Redis/ClickHouse`
    - 正确认知：TiDB 适合 **MySQL 分库分表替代、HTAP 混合负载** 场景；不适合极致低延迟（如 Redis 缓存）、纯 OLAP 分析（如 ClickHouse）、小规模低并发场景（如个人博客）。
    - 避坑提示：没有银弹数据库，TiDB 有明确的适用边界。

---
